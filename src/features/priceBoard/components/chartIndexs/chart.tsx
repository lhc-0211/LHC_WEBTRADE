import {
  AreaSeries,
  createChart,
  HistogramSeries,
  type IChartApi,
  LastPriceAnimationMode,
  PriceScaleMode,
} from "lightweight-charts";
import React, { useEffect, useRef } from "react";

const ChartComponent: React.FC = () => {
  const chartContainerRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    if (!chartContainerRef.current) return;

    const chart: IChartApi = createChart(chartContainerRef.current, {
      handleScale: false, // Tắt zoom
      handleScroll: false, // Tắt scroll
      rightPriceScale: {
        visible: false,
        scaleMargins: {
          top: 0.3,
          bottom: 0.25,
        },
        mode: PriceScaleMode.Logarithmic,
      },
      layout: {
        background: {
          color: "var(--color-sidebar-default)",
        },
        textColor: "#ffffffa3",
        fontFamily: "Plus Jakarta Sans",
        fontSize: 8,
        attributionLogo: false,
      },
      grid: {
        vertLines: {
          color: "rgba(42, 46, 57, 0)",
        },
        horzLines: {
          color: "rgba(42, 46, 57, 0.6)",
        },
      },
      timeScale: {
        timeVisible: true,
        secondsVisible: false,
      },
    });

    const areaSeries = chart.addSeries(AreaSeries, {
      topColor: "rgba(38,198,218, 0.56)",
      bottomColor: "rgba(38,198,218, 0.04)",
      lineColor: "rgba(38,198,218, 1)",
      lineWidth: 1,
      lastPriceAnimation: LastPriceAnimationMode.Continuous,
    });

    const volumeSeries = chart.addSeries(HistogramSeries, {
      color: "#26a69a",
      priceFormat: {
        type: "volume",
      },
      priceScaleId: "",
    });

    volumeSeries.priceScale().applyOptions({
      scaleMargins: {
        top: 0.8,
        bottom: 0,
      },
    });

    const { DateTime, Price, Size }: any = {
      DateTime: {
        "0": 1654867800000,
        "1": 1654867800000,
        "2": 1654867800000,
        "3": 1654867800000,
        "4": 1654867800000,
        "5": 1654867801000,
        "6": 1654867801000,
        "7": 1654867801000,
        "8": 1654867801000,
        "9": 1654867801000,
        "10": 1654867801000,
        "11": 1654867801000,
        "12": 1654867801000,
        "13": 1654867801000,
        "14": 1654867801000,
        "15": 1654867801000,
        "16": 1654867801000,
        "17": 1654867801000,
        "18": 1654867801000,
        "19": 1654867801000,
        "20": 1654867801000,
        "21": 1654867801000,
        "22": 1654867801000,
        "23": 1654867801000,
        "24": 1654867801000,
        "25": 1654867801000,
        "26": 1654867801000,
        "27": 1654867801000,
        "28": 1654867801000,
        "29": 1654867801000,
        "30": 1654867801000,
        "31": 1654867801000,
        "32": 1654867801000,
        "33": 1654867801000,
        "34": 1654867801000,
        "35": 1654867801000,
        "36": 1654867801000,
        "37": 1654867801000,
        "38": 1654867801000,
        "39": 1654867801000,
        "40": 1654867801000,
        "41": 1654867801000,
        "42": 1654867801000,
        "43": 1654867801000,
        "44": 1654867801000,
        "45": 1654867801000,
        "46": 1654867802000,
        "47": 1654867802000,
        "48": 1654867802000,
        "49": 1654867802000,
        "50": 1654867802000,
        "51": 1654867802000,
        "52": 1654867802000,
        "53": 1654867802000,
        "54": 1654867802000,
        "55": 1654867802000,
        "56": 1654867802000,
        "57": 1654867802000,
        "58": 1654867802000,
        "59": 1654867802000,
        "60": 1654867802000,
        "61": 1654867802000,
        "62": 1654867802000,
        "63": 1654867802000,
        "64": 1654867802000,
        "65": 1654867802000,
        "66": 1654867802000,
        "67": 1654867802000,
        "68": 1654867802000,
        "69": 1654867802000,
        "70": 1654867802000,
        "71": 1654867802000,
        "72": 1654867802000,
        "73": 1654867802000,
        "74": 1654867802000,
        "75": 1654867803000,
        "76": 1654867803000,
        "77": 1654867803000,
        "78": 1654867803000,
        "79": 1654867803000,
        "80": 1654867803000,
        "81": 1654867803000,
        "82": 1654867803000,
        "83": 1654867803000,
        "84": 1654867803000,
        "85": 1654867803000,
        "86": 1654867803000,
        "87": 1654867803000,
        "88": 1654867803000,
        "89": 1654867803000,
        "90": 1654867803000,
        "91": 1654867803000,
        "92": 1654867803000,
        "93": 1654867803000,
        "94": 1654867803000,
        "95": 1654867803000,
        "96": 1654867803000,
        "97": 1654867803000,
        "98": 1654867803000,
        "99": 1654867803000,
        "100": 1654867803000,
      },
      Price: {
        "0": 137.63,
        "1": 137.63,
        "2": 137.81,
        "3": 137.81,
        "4": 137.81,
        "5": 137.62,
        "6": 137.8,
        "7": 137.8,
        "8": 137.8,
        "9": 137.8,
        "10": 137.8,
        "11": 137.8,
        "12": 137.8,
        "13": 137.8,
        "14": 137.8,
        "15": 137.8,
        "16": 137.8,
        "17": 137.8,
        "18": 137.8,
        "19": 137.8,
        "20": 137.8,
        "21": 137.77,
        "22": 137.75,
        "23": 137.8,
        "24": 137.75,
        "25": 137.75,
        "26": 137.72,
        "27": 137.7,
        "28": 137.7,
        "29": 137.8,
        "30": 137.81,
        "31": 137.75,
        "32": 137.66,
        "33": 137.79,
        "34": 137.78,
        "35": 137.77,
        "36": 137.96,
        "37": 137.6156,
        "38": 137.81,
        "39": 137.81,
        "40": 137.81,
        "41": 137.7316,
        "42": 137.8,
        "43": 137.81,
        "44": 137.81,
        "45": 137.81,
        "46": 137.78,
        "47": 137.8,
        "48": 137.6156,
        "49": 137.8,
        "50": 137.8,
        "51": 137.8,
        "52": 137.8,
        "53": 137.8,
        "54": 137.8,
        "55": 137.8,
        "56": 137.8,
        "57": 137.8,
        "58": 137.8,
        "59": 137.8,
        "60": 137.8,
        "61": 137.6641,
        "62": 137.66,
        "63": 137.66,
        "64": 137.66,
        "65": 137.66,
        "66": 137.8,
        "67": 137.8,
        "68": 137.66,
        "69": 137.8,
        "70": 137.79,
        "71": 137.78,
        "72": 137.8,
        "73": 137.8,
        "74": 137.59,
        "75": 137.61,
        "76": 137.61,
        "77": 137.6,
        "78": 137.59,
        "79": 137.59,
        "80": 137.59,
        "81": 137.59,
        "82": 137.59,
        "83": 137.8,
        "84": 137.8,
        "85": 137.8,
        "86": 137.8,
        "87": 137.8,
        "88": 137.8,
        "89": 137.63,
        "90": 137.55,
        "91": 137.55,
        "92": 137.51,
        "93": 137.5,
        "94": 137.5,
        "95": 137.5,
        "96": 137.5,
        "97": 137.5,
        "98": 137.49,
        "99": 137.3232,
        "100": 137.44,
      },
      Size: {
        "0": 25,
        "1": 25,
        "2": 1,
        "3": 1,
        "4": 1,
        "5": 1,
        "6": 178715,
        "7": 4,
        "8": 15,
        "9": 4123,
        "10": 11,
        "11": 12381,
        "12": 10,
        "13": 7,
        "14": 12,
        "15": 50,
        "16": 28,
        "17": 100,
        "18": 10,
        "19": 7,
        "20": 7,
        "21": 61,
        "22": 100,
        "23": 4,
        "24": 2,
        "25": 1,
        "26": 6,
        "27": 5,
        "28": 13,
        "29": 51,
        "30": 1,
        "31": 141,
        "32": 1,
        "33": 2,
        "34": 3,
        "35": 3,
        "36": 25,
        "37": 1,
        "38": 1,
        "39": 1,
        "40": 1,
        "41": 1,
        "42": 63,
        "43": 1,
        "44": 1,
        "45": 1,
        "46": 100,
        "47": 1,
        "48": 1,
        "49": 1,
        "50": 1,
        "51": 1,
        "52": 1,
        "53": 50,
        "54": 1,
        "55": 10,
        "56": 600,
        "57": 89,
        "58": 3,
        "59": 4,
        "60": 97,
        "61": 1,
        "62": 25,
        "63": 100,
        "64": 14,
        "65": 81,
        "66": 1,
        "67": 1,
        "68": 1,
        "69": 1,
        "70": 1,
        "71": 1,
        "72": 120,
        "73": 10,
        "74": 2,
        "75": 7,
        "76": 13,
        "77": 7,
        "78": 180,
        "79": 100,
        "80": 100,
        "81": 20,
        "82": 100,
        "83": 1,
        "84": 1,
        "85": 1,
        "86": 1,
        "87": 108,
        "88": 3,
        "89": 1,
        "90": 10,
        "91": 5,
        "92": 21,
        "93": 50,
        "94": 50,
        "95": 10,
        "96": 200,
        "97": 186,
        "98": 8,
        "99": 75,
        "100": 20,
      },
    };
    const chartData: any = [];
    const barData: any = [];

    let lastDateTime = 0;
    let step = 1;

    for (const i in Object.keys(DateTime)) {
      let timestamp = DateTime[i] / 1000;
      if (DateTime[i] === lastDateTime) {
        timestamp = (DateTime[i] + step) / 1000;
        step++;
      } else {
        step = 1;
        lastDateTime = DateTime[i];
      }

      chartData.push({ time: timestamp, value: Price[i] });
      barData.push({
        time: timestamp,
        value: Size[i],
        color: Size[i] > Size[0] ? "#26a69a" : "#ef5350",
      });
    }

    areaSeries.setData(chartData);
    volumeSeries.setData(barData);

    return () => chart.remove();
  }, []);

  return (
    <div ref={chartContainerRef} className="chart-container w-full h-full" />
  );
};

export default ChartComponent;
